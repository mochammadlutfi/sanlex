import{g as n,i as D,a as b,o as g,w as a,d as i,b as o,j as c,f as u,k as V,e as F,P,u as C,t as h,E as K,I as O,l as $,N as z}from"./app-BGxfkQyo.js";import{E as y}from"./lodash-B8vTn4c7.js";import{_ as A}from"./SelectBranch-CL1YkpOk.js";import{E as G,a as J}from"./index-D86IKBYl.js";import{E as Q}from"./index-BJIagJY3.js";import{E as W,a as X}from"./index-CvhItr7_.js";import{E as Y,a as Z}from"./index-BPi1rbym.js";import{E as ee,a as ae}from"./index-CyV8PQJT.js";import{E as oe}from"./index-D_ov1zZm.js";import{v as te}from"./directive-Chdceyer.js";import"./scroll-B9W2qgUL.js";const se={class:"content"},le={class:"content-header"},re={class:"mt-auto mb-0"},ne={class:"text-lg font-semibold"},ie={class:"mt-auto mb-0"},ce={class:"p-4"},de={class:"flex"},ye={__name:"Price",props:{data:{type:Object,default:null}},setup(v){const k=v;n(""),n("");const E=n(null),w=n(!1);n([]);const p=n(!1),t=n({branch_id:"",priceList:[]}),B=async()=>{if(t.value.branch_id){p.value=!0;try{const s=await $.get(`/product/${k.data.id}/price/data`,{params:{branch_id:t.value.branch_id}});s.status===200&&(t.value.priceList=[],s.data.forEach(e=>{t.value.priceList.push({id:e.price,product_id:e.product_id,variant_id:e.variant_id,branch_id:e.branch_id,name:e.name,packaging_id:e.packaging_id,packaging:e.packaging,color_id:e.color_id,color:e.color,code:e.code,price:e.price})}))}catch{}p.value=!1}else t.value.priceList=[]},N=n({}),R=({row:s,column:e,rowIndex:r,columnIndex:_})=>{if(_===0)if(r===0||s.packaging_id!==t.value.priceList[r-1].packaging_id){let d=1;for(let m=r+1;m<t.value.priceList.length&&t.value.priceList[m].packaging_id===s.packaging_id;m++)d++;return{rowspan:d,colspan:1}}else return{rowspan:0,colspan:0}},S=async()=>{E.value&&E.value.validate(async(s,e)=>{if(s){w.value=!0;try{const r=`/product/${k.data.id}/price/store`;(await $({method:"post",url:r,data:t.value})).status===200&&(z.replace("/product"),y({message:h("message.success_save"),type:"success"}))}catch(r){console.log(r),y({message:h("message.error_server"),type:"error"})}w.value=!1}else console.log(s),console.log(e),y({message:h("message.error_input"),type:"error"})})};return(s,e)=>{const r=J,_=G,d=X,m=Z,H=Y,f=ae,I=oe,M=ee,T=K,U=W,j=Q,q=D("base-layout"),L=te;return g(),b(q,null,{default:a(()=>[i("div",se,[i("div",le,[i("div",re,[i("div",ne,"Harga "+c(v.data.name),1)]),i("div",ie,[o(_,{separator:"/"},{default:a(()=>[o(r,{to:{path:"/dashboard"}},{default:a(()=>[u(c(s.$t("base.dashboard")),1)]),_:1}),o(r,null,{default:a(()=>e[1]||(e[1]=[u("Customer")])),_:1})]),_:1})])]),o(j,{"body-class":"!p-0",class:"!rounded-lg !shadow-md !mb-10"},{default:a(()=>[V((g(),b(U,{model:t.value,ref_key:"formRef",ref:E,rules:N.value,onSubmit:F(S,["prevent"]),"label-position":"top"},{default:a(()=>[i("div",ce,[o(H,{gutter:16,class:"mb-4"},{default:a(()=>[o(m,{md:12},{default:a(()=>[o(d,{label:"Cabang"},{default:a(()=>[o(A,{modelValue:t.value.branch_id,"onUpdate:modelValue":e[0]||(e[0]=l=>t.value.branch_id=l),disabled:p.value,onChange:B},null,8,["modelValue","disabled"])]),_:1})]),_:1})]),_:1}),V((g(),b(M,{data:t.value.priceList,border:"",class:"w-full mb-4",id:"variant","row-key":"name","span-method":R},{default:a(()=>[o(f,{label:s.$t("base.packaging"),width:"300"},{default:a(l=>[u(c(l.row.packaging.name),1)]),_:1},8,["label"]),v.data.color.length?(g(),b(f,{key:0,label:s.$t("base.color")},{default:a(l=>[u(c(l.row.color.code)+" - "+c(l.row.color.name),1)]),_:1},8,["label"])):P("",!0),o(f,{label:"Kode"},{default:a(l=>[u(c(l.row.code),1)]),_:1}),o(f,{label:"Harga"},{default:a(l=>[o(d,{prop:"priceList."+l.$index+".price",rules:[{required:!0,message:C(h)("validation.required",{attribute:"Harga"}),trigger:"blur"}]},{default:a(()=>[o(I,{modelValue:l.row.price,"onUpdate:modelValue":x=>l.row.price=x},null,8,["modelValue","onUpdate:modelValue"])]),_:2},1032,["prop","rules"])]),_:1})]),_:1},8,["data"])),[[L,p.value]]),i("div",de,[o(T,{disabled:!t.value.priceList.length,"native-type":"submit",type:"primary"},{default:a(()=>[o(C(O),{icon:"mingcute:check-fill",class:"me-2"}),u(" "+c(s.$t("common.save")),1)]),_:1},8,["disabled"])])])]),_:1},8,["model","rules"])),[[L,w.value]])]),_:1})])]),_:1})}}};export{ye as default};
